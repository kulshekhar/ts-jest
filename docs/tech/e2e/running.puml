@startuml "Running a test case"
start

:create work dir;
note right
  It'll be different per test-case
  and per template basis.
end note
-> e2e/~__workdir_symlink__/{template}/{test-case};

if (has a node_modules dir?) then (yes)
  :symlink node_modules;
  note left
    avoid re-running npm install
    for each test case and template;
  end note
else (no)
endif

:copy files from template;
note right
  all files in template dir are
  copied to test case work dir
  except `node_modules` and
  `package-lock.josn`
end note

while (for each file in test case dir)
  if (is snapshot dir) then (yes)
    :symlink dir;
    note left
      snapshots directories are symlinked
      to test case source dir so that
      updating them would update in the
      source folder
    end note

  else if (is jest.config.js) then (yes)
    if (jest.config.js is function?) then (yes)
      :call with parent content;
      note left
        allows for
        extending
      end note
    else (no)
    endif

  else (others)
    :copy;
    note right
      all files in test case source
      dir are copied to the work dir
      except `node_modules` and
      `package-lock.josn`
    end note

  endif
endwhile

:create special files;
note right
  some special files are created
  to handle hooks for example and
  grab `process()` IO for later
  expectations
end note

:update package.json;
note right
  set a custom but fixed name
  and version in package.json
  which is specific to the
  test case + template
end note

#tomato:run tests;

while (for each snapshot) is (missing in test case)
  :copy;
  note right
    while we symlinked each snapshots
    directory, newly created snapshots
    in non existing dir will need to
    be copied over into
    e2e/~__cases__/{test-case}
  end note
endwhile

:return results;

stop

@enduml
