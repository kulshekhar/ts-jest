"use strict";(self.webpackChunkts_jest_docs=self.webpackChunkts_jest_docs||[]).push([["5891"],{9611:function(e,n,s){s.r(n),s.d(n,{default:()=>u,frontMatter:()=>r,metadata:()=>t,assets:()=>d,toc:()=>c,contentTitle:()=>l});var t=JSON.parse('{"id":"guides/troubleshooting","title":"Troubleshooting","description":"During your development with ts-jest, you may encounter various issues. Use this guide to resolve them.","source":"@site/versioned_docs/version-29.3/guides/troubleshooting.md","sourceDirName":"guides","slug":"/guides/troubleshooting","permalink":"/ts-jest/docs/guides/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/kulshekhar/ts-jest/edit/main/website/versioned_docs/version-29.3/guides/troubleshooting.md","tags":[],"version":"29.3","lastUpdatedBy":"renovate[bot]","lastUpdatedAt":1746694197000,"frontMatter":{"id":"troubleshooting","title":"Troubleshooting"},"sidebar":"docs","previous":{"title":"Using with React Native","permalink":"/ts-jest/docs/guides/react-native"},"next":{"title":"Using with monorepo","permalink":"/ts-jest/docs/guides/using-with-monorepo"}}'),o=s("5893"),i=s("65");let r={id:"troubleshooting",title:"Troubleshooting"},l=void 0,d={},c=[{value:"Running ts-jest on CI tools",id:"running-ts-jest-on-ci-tools",level:2},{value:"PROBLEM",id:"problem",level:3},{value:"SOLUTION",id:"solution",level:3},{value:"Transform (node)-module explicitly",id:"transform-node-module-explicitly",level:2},{value:"PROBLEM",id:"problem-1",level:3},{value:"SOLUTION",id:"solution-1",level:3},{value:"Tests gets stuck when importing a dependency",id:"tests-gets-stuck-when-importing-a-dependency",level:2},{value:"PROBLEM",id:"problem-2",level:3},{value:"SOLUTION",id:"solution-2",level:3}];function a(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"During your development with ts-jest, you may encounter various issues. Use this guide to resolve them."}),"\n",(0,o.jsxs)(n.p,{children:["Please also check Jest ",(0,o.jsx)(n.a,{href:"https://jestjs.io/docs/en/troubleshooting",children:"troubleshooting guide"})," if your issue is related to jest."]}),"\n",(0,o.jsx)(n.h2,{id:"running-ts-jest-on-ci-tools",children:"Running ts-jest on CI tools"}),"\n",(0,o.jsx)(n.h3,{id:"problem",children:"PROBLEM"}),"\n",(0,o.jsx)(n.p,{children:'Cannot find module "" from ""'}),"\n",(0,o.jsx)(n.h3,{id:"solution",children:"SOLUTION"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Check if ",(0,o.jsx)(n.code,{children:"rootDir"})," is referenced correctly. If not add this on your existing jest configuration."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest'\n\nconst config: Config = {\n  //...\n  roots: ['<rootDir>'],\n}\n\nexport default config\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Check if module directories are included on your jest configuration. If not add this on your existing jest configuration."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest'\n\nconst config: Config = {\n  //...\n  moduleDirectories: ['node_modules', '<module-directory>'],\n  modulePaths: ['<path-of-module>'],\n}\n\nexport default config\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Check if module name is properly mapped and can be referenced by jest. If not, you can define moduleNameMapper for your jest configuration."}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest'\n\nconst config: Config = {\n  //...\n  moduleNameMapper: {\n    '<import-path>': '<rootDir>/<real-physical-path>',\n  },\n}\n\nexport default config\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Check github folder names if its identical to you local folder names. Sometimes github never updates your folder names even if you rename it locally. If this happens rename your folders via github or use this command ",(0,o.jsx)(n.code,{children:"git mv <source> <destination>"})," and commit changes."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"transform-node-module-explicitly",children:"Transform (node)-module explicitly"}),"\n",(0,o.jsx)(n.h3,{id:"problem-1",children:"PROBLEM"}),"\n",(0,o.jsx)(n.p,{children:"SyntaxError: Cannot use import statement outside a module"}),"\n",(0,o.jsx)(n.h3,{id:"solution-1",children:"SOLUTION"}),"\n",(0,o.jsx)(n.p,{children:"One of the node modules hasn't the correct syntax for Jests execution step. It needs to\nbe transformed first."}),"\n",(0,o.jsx)(n.p,{children:"There is a good chance that the error message shows which module is affected:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'    SyntaxError: Cannot use import statement outside a module\n    > 22 | import Component from "../../node_modules/some-module/lib";\n         | ^\n'})}),"\n",(0,o.jsxs)(n.p,{children:["In this case ",(0,o.jsx)(n.strong,{children:"some-module"})," is the problem and needs to be transformed.\nBy adding the following line to the configuration file it will tell Jest which modules\nshouldnt be ignored during the transformation step:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="jest.config.ts"',children:"import type { Config } from 'jest'\n\nconst config: Config = {\n  //...\n  transformIgnorePatterns: ['node_modules/(?!(some-module|another-module))'],\n}\n\nexport default config\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"some-module"})," and ",(0,o.jsx)(n.strong,{children:"another-module"})," will be transformed."]}),"\n",(0,o.jsxs)(n.p,{children:["For more information see ",(0,o.jsx)(n.a,{href:"https://stackoverflow.com/questions/63389757/jest-unit-test-syntaxerror-cannot-use-import-statement-outside-a-module",children:"here"})," and ",(0,o.jsx)(n.a,{href:"https://stackoverflow.com/questions/52035066/how-to-write-jest-transformignorepatterns",children:"here"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"tests-gets-stuck-when-importing-a-dependency",children:"Tests gets stuck when importing a dependency"}),"\n",(0,o.jsx)(n.h3,{id:"problem-2",children:"PROBLEM"}),"\n",(0,o.jsx)(n.p,{children:"Without cache, jest takes an extremely long time to process files and appears to be stuck."}),"\n",(0,o.jsx)(n.h3,{id:"solution-2",children:"SOLUTION"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"ts-jest"})," internally uses TypeScript compiler API to transform ts/js file into js file. The recommendation is to only transform what is needed."]}),"\n",(0,o.jsxs)(n.p,{children:["A possible cause for that issue is that you may have enabled ",(0,o.jsx)(n.code,{children:"ts-jest"})," to process javascript files in addition to TypeScript files. This leads to the result that more files are loaded which can, in some cases, blow up the machine."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["In your tsconfig file, check if ",(0,o.jsx)(n.code,{children:"compilerOptions.allowJs"})," is unset or set to false."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",metastring:'title="tsconfig.json"',children:'{\n  "compilerOptions": {\n    "allowJs": false\n  }\n}\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["In your jest configuration, check if the transform property includes only ",(0,o.jsx)(n.code,{children:".ts"})," files for ts-jest. If not, change the regular expression to exclude js files. You can also enable ",(0,o.jsx)(n.code,{children:"isolatedModules: true"})," in tsconfig for ",(0,o.jsx)(n.code,{children:"ts-jest"})," to use transpilation mode (similarly to other transpilers like ",(0,o.jsx)(n.code,{children:"Babel"}),"/",(0,o.jsx)(n.code,{children:"SWC"}),"/",(0,o.jsx)(n.code,{children:"Esbuild"}),") for tests."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-diff",children:"module.exports = {\n  ...\n  'transform': {\n-    '^.+\\\\.(t|j)s$': ['ts-jest', {}],\n+    '^.+\\\\.ts$': 'ts-jest',\n  },\n};\n"})}),"\n",(0,o.jsxs)(n.p,{children:["For more information see ",(0,o.jsx)(n.a,{href:"https://github.com/kulshekhar/ts-jest/issues/4294",children:"here"})]})]})}function u(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},65:function(e,n,s){s.d(n,{Z:function(){return l},a:function(){return r}});var t=s(7294);let o={},i=t.createContext(o);function r(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);